# backend/app/api/endpoints/auth.py

from fastapi import APIRouter, Depends
from sqlalchemy.orm import Session
from app.db.session import get_db
from app.db.models.user import User
from pydantic import BaseModel

router = APIRouter()

class UserRegisterRequest(BaseModel):
    email: str
    name: str | None = None
    image: str | None = None

@router.post("/auth/register")
def register_user(request: UserRegisterRequest, db: Session = Depends(get_db)):
    user = db.query(User).filter(User.email == request.email).first()
    if user:
        return {"message": "既に登録済み"}

    new_user = User(
        email=request.email,
        name=request.name,
        image=request.image,
    )
    db.add(new_user)
    db.commit()
    return {"message": "登録完了"}
